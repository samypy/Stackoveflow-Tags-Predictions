Sub CopyWorkbookWithObjects()
    Dim oldWorkbook As Workbook
    Dim newWorkbook As Workbook
    Dim oldSheet As Worksheet
    Dim newSheet As Worksheet
    Dim pt As PivotTable
    Dim ch As ChartObject
    Dim sl As SlicerCache
    Dim wsName As String
    Dim ptName As String
    Dim chName As String
    Dim slName As String
    Dim chSeries As Series

    ' Set the source workbook (workbook to copy from)
    Set oldWorkbook = ThisWorkbook ' Change this to the workbook you want to copy from

    ' Create a new workbook
    Set newWorkbook = Workbooks.Add

    ' Loop through all sheets in the old workbook
    For Each oldSheet In oldWorkbook.Sheets
        wsName = oldSheet.Name
        oldSheet.Copy After:=newWorkbook.Sheets(newWorkbook.Sheets.Count)
        Set newSheet = newWorkbook.Sheets(newWorkbook.Sheets.Count)
        newSheet.Name = wsName
    Next oldSheet

    ' Loop through all pivot tables in the old workbook
    For Each pt In oldWorkbook.Sheets(1).PivotTables
        ptName = pt.Name
        pt.TableRange2.Copy
        newWorkbook.Sheets(1).Range("A1").PasteSpecial xlPasteValues
        Set pt = newWorkbook.Sheets(1).PivotTables.Add(PivotCache:=pt.PivotCache, TableDestination:=newWorkbook.Sheets(1).Range("A1"), TableName:=ptName)
    Next pt

    ' Loop through all charts in the old workbook
    For Each ch In oldWorkbook.Sheets(1).ChartObjects
        chName = ch.Name
        ch.Copy
        newWorkbook.Sheets(1).Paste
        Set ch = newWorkbook.Sheets(1).ChartObjects(newWorkbook.Sheets(1).ChartObjects.Count)
        ch.Name = chName
        
        ' Update the chart series data ranges
        For Each chSeries In ch.Chart.SeriesCollection
            chSeries.Formula = Replace(chSeries.Formula, oldWorkbook.Sheets(1).Name, newWorkbook.Sheets(1).Name)
        Next chSeries
    Next ch

    ' Loop through all slicers in the old workbook
    For Each sl In oldWorkbook.SlicerCaches
        slName = sl.Name
        sl.Copy
        Set sl = newWorkbook.SlicerCaches(newWorkbook.SlicerCaches.Count)
        sl.Name = slName
    Next sl

    Application.CutCopyMode = False
End Sub

Sub UpdateChartSeriesData()
    Dim ws As Worksheet
    Dim co As ChartObject
    Dim ch As Chart
    Dim series As Series

    ' Loop through all worksheets in the current workbook
    For Each ws In ThisWorkbook.Worksheets
        ' Loop through all chart objects in the worksheet
        For Each co In ws.ChartObjects
            Set ch = co.Chart
            ' Loop through all series in the chart
            For Each series In ch.SeriesCollection
                ' Update the series formula to refer to the current workbook
                series.Formula = Replace(series.Formula, ws.Parent.Name, ThisWorkbook.Name)
            Next series
        Next co
    Next ws
End Sub

Sub CheckSlicerConnections()
    Dim ws As Worksheet
    Dim sc As SlicerCache
    Dim si As SlicerItem
    Dim reportConnection As PivotTable
    Dim hasSlicers As Boolean
    
    On Error Resume Next
    ' Loop through each worksheet in the workbook
    For Each ws In ThisWorkbook.Worksheets
        hasSlicers = False ' Flag to check if the worksheet has slicers
        ' Loop through each slicer cache in the workbook
        For Each sc In ThisWorkbook.SlicerCaches
            If sc.Parent.Name = ws.Name Then
                hasSlicers = True
                ' Loop through each slicer item in the slicer cache
                For Each si In sc.SlicerItems
                    ' Click on the slicer item to select it
                    si.Selected = True
                    ' Delay to allow for the slicer animation (optional)
                    Application.Wait Now + TimeValue("00:00:01")
                    
                    ' Check if there's an associated PivotTable (Report Connection)
                    If Not sc.PivotTables.Count = 0 Then
                        ' Get the PivotTable associated with the slicer cache
                        Set reportConnection = sc.PivotTables(1)
                        ' Display the name of the PivotTable associated with the slicer
                        MsgBox "Slicer: " & si.Name & vbNewLine & _
                               "Report Connection: " & reportConnection.Name
                    Else
                        ' If there's no associated PivotTable, display a message
                        MsgBox "Slicer: " & si.Name & vbNewLine & "No Report Connection"
                    End If
                    
                    ' Clear the slicer selection to prepare for the next iteration
                    si.Selected = False
                Next si
            End If
        Next sc
        
        ' Display a message if the worksheet has no slicers
        If Not hasSlicers Then
            MsgBox "Worksheet: " & ws.Name & vbNewLine & "No Slicers Found"
        End If
    Next ws
    On Error GoTo 0
End Sub
