import os
import glob
import pandas as pd

# set directory path
directory_path = "/path/to/directory"

# check if the directory exists
if not os.path.isdir(directory_path):
    print("Directory does not exist.")
    exit()

# get list of excel files in all subdirectories
excel_files = glob.glob(os.path.join(directory_path, '**/*.xlsx'), recursive=True)

# check if there are any excel files in directory
if not excel_files:
    print("No excel files found in directory.")
    exit()

# read first excel file to get number of columns and headers
df = pd.read_excel(excel_files[0])
num_cols = len(df.columns)
headers = list(df.columns)

# loop through excel files and merge them
for i, excel_file in enumerate(excel_files):
    # read excel file
    df = pd.read_excel(excel_file)
    
    # check if number of columns matches
    if len(df.columns) != num_cols:
        print(f"Skipping {excel_file} because number of columns does not match.")
        continue
    
    # skip header rows for all files except the first one
    if i > 0:
        df = df.iloc[1:]
        df.columns = headers
    
    # merge dataframes
    if i == 0:
        merged_df = df
    else:
        merged_df = pd.concat([merged_df, df], axis=0)
        
# save merged dataframe to excel file
merged_df.to_excel(os.path.join(directory_path, "merged.xlsx"), index=False)
print("Merged file saved to directory.")

